---
import BaseLayout from '../layouts/BaseLayout.astro';
import { loadAllHarnesses, getFieldSafe } from '../data/loader.ts';

const harnesses = loadAllHarnesses();

const questions = [
  {
    title: 'Do you need cross-model reliability?',
    description: 'Some harnesses are tightly coupled to one provider; others abstract the model layer so you can swap freely.',
    strong: ['OpenCode', 'Pi'],
  },
  {
    title: 'Do you need strong sandboxing?',
    description: 'OS-level sandboxing (seccomp, seatbelt) that restricts what the agent can touch.',
    strong: ['Codex CLI'],
  },
  {
    title: 'Do you want a rich skills/plugins ecosystem?',
    description: 'Pre-built capabilities the community can share, install, and compose without modifying core code.',
    strong: ['OpenCode', 'Pi', 'Codex CLI'],
  },
  {
    title: 'Do you care about a first-class TUI experience?',
    description: 'A polished terminal interface with streaming output, key bindings, and themes.',
    strong: ['OpenCode', 'Pi', 'Codex CLI'],
  },
  {
    title: 'Do you need SDK/API integration?',
    description: 'Use the harness as a library inside your own application or CI pipeline.',
    strong: ['Codex CLI', 'OpenCode', 'Pi'],
  },
  {
    title: 'Do you need MCP support?',
    description: 'Connect to external tool servers via the Model Context Protocol for extended capabilities.',
    strong: ['Codex CLI', 'OpenCode'],
  },
];
---

<BaseLayout title="Home">
  <!-- Hero -->
  <section class="hero fade-in">
    <p class="hero__label mono muted">Source-backed comparison of AI coding agent harnesses</p>
    <h1 class="hero__title">Harness Matrix</h1>
    <p class="hero__subtitle">
      Source-backed comparison of AI coding agent harnesses. Every claim has evidence.
    </p>
    <p class="hero__body">
      The harness — the scaffolding around the LLM — often determines real-world success more than the model itself.
      Changing only the edit tool can produce large jumps in success rate.
      This matrix documents harness behavior so you can pick the right one.
    </p>
    <div class="hero__ctas">
      <a href="/compare" class="cta cta--primary">Compare harnesses →</a>
      <a href="/contribute" class="cta cta--secondary">How to contribute</a>
    </div>
  </section>

  <!-- Pick a Harness -->
  <section>
    <div class="section-header fade-in-up stagger-1">
      <h2>Pick a Harness</h2>
    </div>
    <div class="grid grid--3">
      {questions.map((q, i) => (
        <a href="/compare" class={`card question-card fade-in-up stagger-${(i % 4) + 1}`}>
          <h4 class="question-card__title">{q.title}</h4>
          <p class="question-card__desc muted">{q.description}</p>
          <div class="question-card__tags">
            {q.strong.map((name) => (
              <span class="badge badge--high">{name}</span>
            ))}
          </div>
        </a>
      ))}
    </div>
  </section>

  <!-- All Harnesses -->
  <section>
    <div class="section-header fade-in-up stagger-2">
      <h2>All Harnesses</h2>
    </div>
    <div class="grid grid--3">
      {harnesses.map((h, i) => {
        const id = getFieldSafe(h, 'id').value;
        const name = getFieldSafe(h, 'name').value;
        const license = getFieldSafe(h, 'license').value;
        const language = getFieldSafe(h, 'primary_language').value;
        const mechanisms = getFieldSafe(h, 'edit', 'mechanism').value;
        return (
          <a href={`/h/${id}`} class={`card harness-card fade-in-up stagger-${(i % 4) + 1}`}>
            <h3 class="harness-card__name">{name ?? id}</h3>
            <dl class="harness-card__meta">
              {license && (
                <>
                  <dt class="muted">License</dt>
                  <dd>{license}</dd>
                </>
              )}
              {language && (
                <>
                  <dt class="muted">Language</dt>
                  <dd>{language}</dd>
                </>
              )}
            </dl>
            {Array.isArray(mechanisms) && mechanisms.length > 0 && (
              <div class="harness-card__badges">
                {mechanisms.map((m: string) => (
                  <span class="badge badge--medium">{m}</span>
                ))}
              </div>
            )}
            <span class="harness-card__link accent mono">View details →</span>
          </a>
        );
      })}
    </div>
  </section>
</BaseLayout>

<style>
  /* Hero */
  .hero {
    padding: var(--sp-16) 0 var(--sp-12);
    border-bottom: 1px solid var(--c-border);
    margin-bottom: var(--sp-8);
  }
  .hero__label {
    font-size: var(--fs-xs);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: var(--sp-3);
  }
  .hero__title {
    font-size: clamp(2.25rem, 5vw, 3.5rem);
    letter-spacing: -0.03em;
    margin-bottom: var(--sp-4);
  }
  .hero__subtitle {
    font-family: var(--font-mono);
    font-size: var(--fs-md);
    color: var(--c-text-heading);
    max-width: 42rem;
    margin-bottom: var(--sp-4);
  }
  .hero__body {
    max-width: 42rem;
    color: var(--c-text-muted);
    margin-bottom: var(--sp-8);
    line-height: var(--lh);
  }
  .hero__ctas {
    display: flex;
    gap: var(--sp-4);
    flex-wrap: wrap;
  }

  /* CTAs */
  .cta {
    display: inline-flex;
    align-items: center;
    font-family: var(--font-mono);
    font-size: var(--fs-sm);
    font-weight: 600;
    padding: var(--sp-3) var(--sp-6);
    border-radius: var(--r-md);
    transition: all var(--transition);
  }
  .cta--primary {
    background: var(--c-accent);
    color: var(--c-bg);
  }
  .cta--primary:hover {
    background: var(--c-accent-dim);
    color: var(--c-text-heading);
  }
  .cta--secondary {
    border: 1px solid var(--c-border);
    color: var(--c-text);
  }
  .cta--secondary:hover {
    border-color: var(--c-accent-dim);
    color: var(--c-accent);
  }

  /* Question Cards */
  .question-card {
    display: flex;
    flex-direction: column;
    gap: var(--sp-3);
  }
  .question-card__title {
    font-size: var(--fs-base);
  }
  .question-card__desc {
    font-size: var(--fs-sm);
    flex: 1;
  }
  .question-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--sp-2);
    margin-top: auto;
  }

  /* Harness Cards */
  .harness-card {
    display: flex;
    flex-direction: column;
    gap: var(--sp-3);
  }
  .harness-card__name {
    font-size: var(--fs-lg);
  }
  .harness-card__meta {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: var(--sp-1) var(--sp-3);
    font-size: var(--fs-sm);
  }
  .harness-card__meta dt {
    font-family: var(--font-mono);
    font-size: var(--fs-xs);
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }
  .harness-card__badges {
    display: flex;
    flex-wrap: wrap;
    gap: var(--sp-2);
  }
  .harness-card__link {
    font-size: var(--fs-sm);
    margin-top: auto;
  }
</style>
